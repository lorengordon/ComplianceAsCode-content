prodtype: rhel8,rhel9
description: 'If the <tt>auditd</tt> daemon is configured to use the <tt>augenrules</tt>
    program

    to read audit rules during daemon startup (the default), add the following lines
    to a file

    with suffix <tt>.rules</tt> in the directory <tt>/etc/audit/rules.d</tt> to capture
    kernel module

    loading and unloading events, setting ARCH to either b32 or b64 as appropriate
    for your system:

    <pre>-a always,exit -F arch=<i>ARCH</i> -S query_module -F auid>=1000 -F auid!=unset
    -F key=modules</pre>

    If the <tt>auditd</tt> daemon is configured to use the <tt>auditctl</tt> utility
    to read audit

    rules during daemon startup, add the following lines to <tt>/etc/audit/audit.rules</tt>
    file

    in order to capture kernel module loading and unloading events, setting ARCH to
    either b32 or

    b64 as appropriate for your system:

    <pre>-a always,exit -F arch=<i>ARCH</i> -S query_module -F auid>=1000 -F auid!=unset
    -F key=modules</pre>'
rationale: 'The addition/removal of kernel modules can be used to alter the behavior
    of

    the kernel and potentially introduce malicious code into kernel space. It is important

    to have an audit trail of modules that have been introduced into the kernel.'
severity: medium
references:
    cis: 4.1.3.19
identifiers:
    cce: CCE-88749-7
ocil_clause: no line is returned
ocil: 'To determine if the system is configured to audit calls to the

    <code>query_module</code> system call, run the following command:

    <pre space="preserve">$ sudo grep "query_module" /etc/audit/audit.*</pre>

    If the system is configured to audit this activity, it will return a line.

    '
oval_external_content: null
fixtext: 'Configure the audit system to generate an audit event for any successful/unsuccessful
    use of the "query_module" system call by adding or updating the following rules
    in "/etc/audit/audit.rules" and adding the following rules to "/etc/audit/rules.d/module_chng.rules"
    or updating the existing rules in files in the "/etc/audit/rules.d/" directory:



    -a always,exit -F arch=b32 -S query_module -F auid>=1000 -F auid!=unset -k module_chng

    -a always,exit -F arch=b64 -S query_module -F auid>=1000 -F auid!=unset -k module_chng


    The audit daemon must be restarted for the changes to take effect.'
checktext: ''
vuldiscussion: ''
srg_requirement: ' Red Hat Enterprise Linux 9 must audit all uses of the query_module
    command.'
warnings: []
conflicts: []
requires: []
policy_specific_content: {}
platform: null
platforms: !!set {}
sce_metadata: {}
inherited_platforms: !!set
    machine: null
    package[audit]: null
cpe_platform_names: !!set {}
inherited_cpe_platform_names: !!set
    machine: null
    package_audit: null
bash_conditional: null
fixes: {}
title: Ensure auditd Collects Information on Kernel Module Loading and Unloading -
    query_module
definition_location: /home/oscap/content/linux_os/guide/system/auditing/auditd_configure_rules/audit_kernel_module_loading/audit_rules_kernel_module_loading_query/rule.yml
template: null
documentation_complete: true

# platform = multi_platform_sle
# reboot = false
# strategy = enable
# complexity = low
# disruption = low
- name: Set smartcard packages fact
  set_fact:
    smartcard_packages:
    - pam_pkcs11
    - mozilla-nss
    - mozilla-nss-tools
    - pcsc-ccid
    - pcsc-lite
    - pcsc-tools
    - opensc
    - coolkey
  when:
  - ansible_virtualization_type not in ["docker", "lxc", "openvz", "podman", "container"]
  - ansible_architecture != "s390x"
  tags:
  - CCE-83177-6
  - DISA-STIG-SLES-12-030500
  - NIST-800-53-CM-6(a)
  - PCI-DSS-Req-8.3
  - PCI-DSSv4-8.4
  - enable_strategy
  - install_smartcard_packages
  - low_complexity
  - low_disruption
  - medium_severity
  - no_reboot_needed

- name: Ensure {{ smartcard_packages }} are installed
  package:
    name: '{{ smartcard_packages }}'
    state: present
  when:
  - ansible_virtualization_type not in ["docker", "lxc", "openvz", "podman", "container"]
  - ansible_architecture != "s390x"
  tags:
  - CCE-83177-6
  - DISA-STIG-SLES-12-030500
  - NIST-800-53-CM-6(a)
  - PCI-DSS-Req-8.3
  - PCI-DSSv4-8.4
  - enable_strategy
  - install_smartcard_packages
  - low_complexity
  - low_disruption
  - medium_severity
  - no_reboot_needed
